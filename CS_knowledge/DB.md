# 데이터베이스

**목차**

- [회복](#recovery)





---

## <a name ="recovery">회복</a>

**데이터 베이스 운영 중에 예상치 못한 장애로 인해 상태 이상이 생긴 것을 이전의 일관된 상태로 복원시키는 것.**



**장애유형**

- 트랜잭션 실패 : 트랜잭션을 완료하지 못한 경우.
- 시스템 손상 : DBMS, OS 등의 오류
- 디스크 고장 : 하드웨어가 손상.



**undo, redo**

- undo : 트랜잭션 로그를 이용하여 오류와 관련된 모든 변경을 취소.
- redo : 트랜잭션 로그를 이용하여 오류가 발생한 트랜잭션을 재실행하여 복구.



**로그 파일**

- 트랜잭션이 반영한 모든 데이터의 변경사항을 기록해두는 것.
- 타입 : START, INSERT, UPDATE, DELETE, COMMIT 등의 트랜잭션 연산 타입.
- START와 COMMIT이 있는 경우 REDO / START만 있고 COMMIT이 없으면 UNDO.



**회복기법**

- 로그 기반 회복 기법
  - 지연갱신 회복 기법
    - 트랜잭션의 부분 완료 상태(commit 직전)에선 변경 내용을 로그 파일에만 저장.
    - 커밋이 발생하기 전까지 데이터베이스에 기록 X
    - 중간에 장애가 발생하더라도 아직 DB에 기록되지 않았으므로 로그 폐기
  - 즉시갱신 회복 기법
    - 트랜잭션 수행 도중에도 변경 내용을 즉시 DB에 기록하고 로그 파일로 저장.
    - 만약 장애 발생시 아직 commit이 되지 않았으므로 undo필요.
- 검사적 회복 기법
  - 모든 log를 보며 복구하려면 부하가 너무 크므로 주기적으로 checkpoint를 두어 복구시에 시스템 부하를 줄인다.
  - 장애 발생시 checkpoint 이전 시점은 제외하고 이후 시점부터 복구
  - 검색된 트랜잭션중 완료된 것은 redo, 완료되지 못한 것은 undo하여 복구 진행.









reference

1. https://raisonde.tistory.com/
2. https://abydos.tistory.com/37