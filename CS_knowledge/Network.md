**NETWORK(네트워크)**

---

### **목차**

- [개요](#eab09cec9a94)

- [OSI 7계층](#OSI-7%EA%B3%84%EC%B8%B5)
- [TCP/IP 플로토콜 스택 4계층](#TCP%2FIP%20%ED%94%8C%EB%A1%9C%ED%86%A0%EC%BD%9C%20%EC%8A%A4%ED%83%9D%204%EA%B3%84%EC%B8%B5)
- [TCP/IP 특징](#TCP%2fIP+%ed%8a%b9%ec%a7%95)
- [주요포트 번호](#%ec%a3%bc%ec%9a%94%ed%8f%ac%ed%8a%b8+%eb%b2%88%ed%98%b8)
- [HTTP, HTTPS](#HTTP%2c+HTTPS)
- [GET, POST](#GET%2c+POST)
- [ARP 프로토콜(주소 결정 프로토콜)](#ARP+%ed%94%84%eb%a1%9c%ed%86%a0%ec%bd%9c(%ec%a3%bc%ec%86%8c+%ea%b2%b0%ec%a0%95+%ed%94%84%eb%a1%9c%ed%86%a0%ec%bd%9c))
- [프록시 서버](#%ed%94%84%eb%a1%9d%ec%8b%9c+%ec%84%9c%eb%b2%84)
- [브라우저에서 특정 주소를 입력하였을 때 렌더링 되는 과정](#%eb%b8%8c%eb%9d%bc%ec%9a%b0%ec%a0%80%ec%97%90%ec%84%9c+%ed%8a%b9%ec%a0%95+%ec%a3%bc%ec%86%8c%eb%a5%bc+%ec%9e%85%eb%a0%a5%ed%95%98%ec%98%80%ec%9d%84+%eb%95%8c+%eb%a0%8c%eb%8d%94%eb%a7%81+%eb%90%98%eb%8a%94+%ea%b3%bc%ec%a0%95)
- [Multi-Thread 서버](#Multi-Thread+%ec%84%9c%eb%b2%84)

---

### 개요

**용어정리**

1. 컴퓨터 네트워크 : 컴퓨터와 컴퓨터를 통신망으로 연결한 것

2. 노드 : 컴퓨터 네트워카상에 연결된 장치

3. 호스트 : 고유 IP주소를 가진 노드

4. 링크 : 물리적으로 노드와 노드를 연결하는 통로

5. 홉 : 거리의 단위, 보통 한 링크를 이동하면 한 홉

6. 경로 : 네트워크 상의 두 노드 간의 이동 경로

7. 프로토콜 : 데이터 통신을 원활하게 하기 위해 필요한 통신 규약



### OSI 7계층

**네트워크에서 통신이 이루어지는 과정을 7단계로 나눈 것**

**이유** 

- 통신이 일어나는 과정을 단계별로 파악하고 문제 발생 시에 필요한 단계만 수정할 수 있음.
- 규격을 정함으로써 설계가 유리하고 모듈화 할 수 있다.
- **용이성, 유지관리의 수월성**

<img src="./assets/OSI.PNG">

1. 물리계층
   - 전기적, 기계적, 기능적인 특성을 이용해 통신 케이블로 데이터 전송
   - 통신단위 : **비트**(bit) - 0,1로 표현
   - 데이터를 주고 받기만 할 뿐, 데이터가 무엇인지, 에러가 있는지를 파악하지 않음.
   - 장비 : 통신케이블, 리피터, 허브
   - **정리 : 통신 케이블을 통해 데이터를 전송하는 계층, 데이터의 어떠한 것인지 신경쓰지 않음.**
   
2. 데이터 링크계층

   - 물리 계층을 통해 송수신되는 정보의 오류와 흐름을 관리 - **안전한 정보의 전달을 수행을 도와줌**, **오류검출, 회복을 위한 오류 제어, 흐름 제어**
   - **맥주소**를 가지고 통신 (맥 주소는 네트워크 카드가 생성될 때 부여되는 물리적 주소)
   - 통신단위 : **프레임**
   - 장비 : 브릿지, 스위치
   - **CRC**기반의 오류 제어와 흐름 제어 필요 (전송 전 CRC값을 계산하여 데이터에 붙여 보내고 수신 후 CRC값을 재계산하여 값이 일치하는지 여부를 파악함.)
   - **정리 : 송수신하는 정보가 안전하게 전달되도록 하는 서비스 계층, MAC address를 가지고 통신, 오류 검출과 흐름 제어를 통해 안전하게 도달하도록 함.**

3. 네트워크 계층
   - **데이터를 목적지까지 안전하고 빠르게 전달 (라우팅)**
   - 경로와 주소를 정하고 패킷을 전달하는 역할을 한다.
   - 데이터를 연결된 다른 네트워크를 통해 전달함으로써 인터넷이 가능하게 하는 계층
   - 논리적 주소 (IP)를 가진다. 네트워크 관리자가 주소 할당, 계층적인 형태
   - 통신 단위 : **패킷**
   - 데이터는 패킷 안으로 캡슐화, 패킷 헤더는 송신지와 수신지의 주소들을 포함.
   - TCP/IP -> IP계층 
     - IP패킷의 전달 및 라우팅을 담당하는 계층
     - 데이터링크 계층의 하드웨어적 특성에 관계없이 독립적인 역할 수행
     - IP계층 상에 있는 주요 프로토콜 (IP-패킷전달, ICMP-전달의 에러 보고 및 진단, 라우팅-경로를 찾아줌.)
- **정리 : 시스템간 연결성과 경로 선택을 제공하는 역할, IP address를 이용해 라우팅 프로토콜이 연결된 네트워크에서 최적 경로 선택**
  
4. 전송 계층
   - 통신을 활성화하기 위한 계층, 보통 TCP프로토콜 이용, **포트**를 열어준다.

   - 데이터가 오면 하나로 합쳐 5계층에 던져 준다.

   - 특정 연결의 유효성을 제어, 연결 기반이다.

   - **패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것**

   - **multiplexing** : 전송하려는 데이터를 TCP/UDP 세그먼트로 만들 때 헤더를 추가하여 출발지 포트번호와 목적지 포트번호를 두는 것.

   - **Demultiplexing** : 도착한 세그먼트는 헤더를 확인하여 이 과정을 거친후 대상 소켓에 데이터전달.

   - TCP 프로토콜
     - 양종단 호스트 내 프로세스 상호 간에 신뢰적인 연결지향성 서비스 제공

     - 가상 회선 방식을 제공.

     - **신뢰적인 전송을 보장**

     - Reliable(신뢰성) : 패킷 손실, 중복, 순서 바뀜 등이 없도록 보장

     - Connection-oriented(연결지향적) : 양단간 TCP가 제공하는 연결성 회선을 통해 통신.

     - 3-way handshaking과정을 통해 연결 설정, 4-way handshaking을 통해 해제

     - 3-way handshaking SYNC(Cli) - SYNC+ACK(Ser) - ACK(Cli) 순으로 이루어짐

       <img src="./assets/three_hand.png">

       

     - 4-way handshaking : FIN(Cli)- ACK(Ser) - FIN FLAG(Ser) - ACK(Cli)
       (Client는 server로부터 FIN을 수신하더라도 일정시간동안 세션을 남겨두고 대기)

       <img src="./assets/four_hand.png">

       비정상 종료 사례

       1. colse_wait : 애플리케이션에서 close가 안되어 TCP포트가 계속 CLOSE_WAIT상태로 기다리게 되고 이후에 이런 것들이 계속 쌓이면 이후에 더 이상의 연결을 못하는 경우 발생.
       2. FIN_WAIT1 : ACK를 못받는 상태로 일정 시간이 지나면 TIME OUT으로 자동으로 닫는다. 보통 서버를 찾지 못하는 경우가 많음.
       3. FIN_WAIT2 : ACK이후에 FIN신호를 받지 못하여 기다리는 상태로 이 역시 TIME_OUT이 되면 스스로 닫는다.

     - 스트림 전송으로 전송 데이터의 크기가 무제한

     -  streaming 서비스에 불리함.(만약 패킷이 유실되면 재요청을 해야하므로)

     - 통신 단위 : **세그먼트**

   - UDP프로토콜

     - **신뢰성이 낮은 프로토콜**
     - 가상회선을 굳이 확립할 필요가 없고 유연하며 효율적 응용의 데이타 전송에 사용(비연결형 프로토콜)
     - **비연결성, 신뢰성 없음, 순서화되지 않은 데이터그램**
     - 실시간 응용 및 멀티캐스팅 가능
     - 헤더가 단순(checksum필드를 이용해 최소한의 오류만 검출)
     - 통신단위 : 데이터그램 (독립적인 관계를 지니는 패킷)
     - 서버 소켓과 클라이언트 소켓의 구분이 없음.
     - IP기반으로 데이터 전송.
     - 최대 전송 크기는 65535바이트임.

     <img src = "./assets/TCP_UDP.PNG">

   - **정리 : 최종 시스템 및 호스트 간의 데이터 전송 조율을 담당. 데이터의 용량,속도,목적지 등을 처리**
   
5. 세션 계층

   - 세션 : 둘 이상의 통신 장치나 컴퓨터와 사용자 간의 대화나 송수신 연결상태를 의미하는 보안적인 대화 및 시간대
   - 일정 시간동안 들어오는 일련의 요구를 일정하게 유지시키는 기술이 중요!

   - **데이터가 통신하기 위한 논리적인 연결**
   - 4계층도 연결을 맺고 끊을 수 있기에 어느 계층에서 통신이 끊어졌나 판단하기에는 한계가 있어 4계층과는 무관하게 응용 프로그램 관점에서 봐야한다.
   - **동시 송수신 방식, 반이중 방식, 전이중 방식**의 통신 방법 제공.
   - TCP/IP세션을 만들고 없애는 책임 - 두 HOST 사이에 연결을 제공
   - **포트 연결**이 유효한지 확인하고 설정함
   - 통신 단위 : 메세지
   - **동기 기능, 대화의 기능**을 수행
   - 대화를 관리하기 위해 **토큰**이라는 특수 메세지를 사용. 토큰은 대화 단위를 구분하는 **주동기 토큰**과 대화 내에서 세분화 시켜주는 **부동기 토큰**으로 나뉨.
   - **정리 : 2대의 기기, 컴퓨터 또는 서비 간 대화가 필요할 경우 세션을 만들고 작업을 처리**

6. 표현 계층
   - 데이터 표현이 상이한 응용 프로세스의 독립성 제공, 암호화
   - **MIME인코딩, 암호화** 등을 한다.
   - 사용자 명령어를 완성 및 결과 표현, 포장, 압축, 암호화
   - **정리 : 응용프로그램이나 네트워크를 위해 데이터를 변환하거나 암호화, 복호화한다.**

7. 응용 계층
   - 최종 목적지이다.
   - HTTP, FTP, SMTP, POP3, IMAP, Telnet등과 같은 프로토콜이 있다.
   - 위의 프로토콜을 쉽게 사용할 수 있게 해주는 응용프로그램들이 많다. 
   - **결론적으로 통신의 양 끝단은 프로토콜이지 응용프로그램이 아니다.**
   - **정리 : 사용자에게 보이는 부분으로 웹 브라우저나 응용 프로그램 등이 대표적**



#### **TCP/IP 플로토콜 스택 4계층**

<img src="./assets/TCP_IP.PNG">

1. Network Access Layer
   - OSI 7에서 물리계층, 데이터링크  계층에 해당
   - 네트워크 카드와 디바이스 드라이버 등과 같이 하드웨어적인 요소와 관련되는 모든 것을 지원하는 계층
   - 송신 : 상위 계층에서 전달받은 패킷에 MAC주소를 가진 헤더를 추가하여 프레임 만들고 물리 계층으로 전달.
   - 수신 : 데이터 링크 계층에서 헤더를 제거하여 상위 계층의 네트워크 계층으로 전달.
2. Internet Layer
   - OSI 7에서 네트워크 계층에 해당.
   - 상위 전달 계층에서 받은 데이터에 IP패킷 헤더를 붙여 IP 패킷을 만들어 전송.
   - 통신 노드 간의 IP패킷을 전송하는 기능 및 라우팅 기능 담당.
   - 비연결지향적이며 신뢰할 수 없는 프로토콜 - 매번 경로가 일정치 않다.
3. Host-to-Host
   - OSI 7에서 전송 계층에 해당.
   - 네트워크 양단의 송수신 호스트 사이에서 신뢰성 있는 전송 제공
   - TCP와 UDP프로토콜을 이용한다.
   - 시스템의 논리주소와 포트를 가지고 있어 상위 계층의 프로세스를 연결해서 통신
4. Application Layer
   - 세션, 표현, 애플리케이션 계층에 해당
   - 응용프로그램 등을 이용해 프로토콜과 서비스를 이용하는 인터페이스 제공



#### **TCP/IP 특징**

- 오늘날 인터넷 통신의 대부분은 패킷 통신을 기본으로 함.
- 패킷 통신을 위한 인터넷 규약
- IP : 데이터 조각들을 최대한 빨리 목적지로 보내는 역할(주소 - 호스트의 주소)
- TCP : 도착한 조각을 점검하고 순서를 다시 정리함. 이후, 빠진 패킷이 있으면 재요청.
- PORT : 수신 호스트에서 목표 어플리케이션을 식별하는 번호



#### **네트워크 망**

- LAN : 한 지역적 공간의 호스트들 끼리 연결되어 있는 소규모 네트워크
- WAN : LAN-LAN의 연결하는 대규모 네트워크



#### **주요포트 번호**

- HTTP(80) : 웹을 지원하기 위한 프로토콜, GET,PUT 같은 프로토콜 기능을 포함해 웹 서버에게 어떠한 Content를 요청하고 또는 웹 서버로 정보를 보내는 역할을 수행 (HTTPS(443))
- FTP(20,21) : TCP를 활용해 대량의 파일을 송수신하는 프로토콜
- TFTP(69) : UDP를 사용하는 파일 전송 프로토콜, 주로 장비를 다루는 경우 사용
- Telenet (23) : 원격지에 있는 장비로 표준 터미널 에뮬레이션 기능 제공
- SMTP(25) : 전자메일을 전송하는 프로토콜, 받을 때는 POP3 활용 
- SNMP(161) : 네트워크 장비를 모니터링하고 제어하기 위해 사용하는 프로토콜
- DNS(53) : 도메인 주소를 IP ADDRESS로 변경하는 일



#### **HTTP, HTTPS**

- 웹 브라우저와 휍 서버 사이의 데이터 통신 규칙
- 웹 페이지의 링크를 클릭하면 브라우저는 HTTP요청 형식에 따라 웹 서버에 데이터를 전송, 웹 서버는 브라우저가 보낸 데이터를 분석하여 요청을 처리 후 응답
- HTTP : TCP -> HTTP / HTTPS : TCP -> SSL -> HTTP
- SSL 프로토콜은 정보 암호화시 공개키와 개인키라는 두가지 키를 이용.
- HTTPS는 암호화에 따른 속도 저하 문제가 있음.



#### **GET, POST**

- HTTP프로토콜을 이용해서 서버에 요청할 때 사용. 
- GET 
  - URL을 통해 모든 파라미터 전달 (중요한 정보가 유출될 수 있어 문제 발생.)
  - URL에 길이 제한이 있어 많은 데이터 전달 X
  - 어떤 데이터를 조회해 보여주는 용도에 주로 사용.
- POST
  - 정보가 HTTP BODY에 포함되어 전달(노출 X)
  - 길이 제한이 없음.
  - 서버의 값이나 상태를 바꾸기 위해 사용



#### **ARP 프로토콜(주소 결정 프로토콜)**

- 네트워크 상에서 IP주소를 물리적 네트워크 주소로 대응시키기 위해 사용되는 프로토콜.
- IP(3계층) -> MAC(2계층)으로 대응시킬 때 사용.



#### **프록시 서버**

- 컴퓨터 네트워크에서 다른 서버 사으이 자원을 찾는 클라이언트로부터 요청을 받아 중계하는 서버. 
- 요청된 자원들이 캐시로 임시 저장된다. 이후 재요청을 하게 되면 원격서버에 접속할 필요 없이 프록시 서버 내의 정보를 제공 받음.
- 위의 장점을 활용해 병목현상을 줄일 수 있다.
- 만약 데이터가 자주 갱신되는 서버의 경우 캐시 만료기간을 설정해두어 만료기간 이전에는 프록시에서 이후에는 서버에 재요청 할 수 있도록 하면된다.



#### **브라우저에서 특정 주소를 입력하였을 때 렌더링 되는 과정**

1. local DNS서버에서 해당 주소의 IP주소를 찾는다. 있다면 즉시 ip를 받아온다.

   - 없다면 루트 DNS서버(전 세계에 13대가 운용중 - 우리나라는 없고 미러로 3개 있음)에 물어본다.
   - 없다면 .com(TLD서버), 또 없다면 이름.com(authoriative서버)에 물어봐 ip를 받아온다.
2. ARP(주소결정프로토콜)를 이용해 IP에서 MAC주소를 알아낸다.

3. TCP/IP통신을 하기 위해 TCP통신을 통해 소켓 개방.

4. HTTP프로토콜을 사용해 HTTP요청 메세지를 생성. - 응용 계층

   (전송 계층에서 TCP에 80번 포트가 헤더에 추가)

   (네트워크 계층에서 내 IP와 목적지 IP가 삽입된 패킷 구성)

   (데이터 링크계층에서 패킷에 MAC주소 프레임 헤더 추가)

   (물리 계층에서 전기적으로 전달)

5. 요청 메세지를 TCP프로토콜을 이용해 해당 서버에 전달. (threehand shaking)

   - 만약 프록시 서버를 만나 캐시에 저장된 것이 있다면 바로 response받는다.

   - 없다면 해당 프록시 서버에서 메인 서버에서 데이터를 response받는다.

6. 이후 html, css 파싱을 거치며 DOM Tree 구성 - 렌더 트리를 만들고 렌더링 한다.



#### **Multi-Thread 서버**

1. listen socket을 통해 클라이언트가 들어오면 자식 프로세스를 만드는 것이 아닌 쓰레드를 만드는 것.
2. 만들어진 쓰레드를 이용해 클라이언트의 요청을 처리하는 것
3. 멀티 프로세스보다 좀 더 작고 빠르게 동작하지만 디버깅이 힘들고 하나의 쓰레드가 문제가 생기면 전체 프로세스에 영향을 끼칠 수 있음.








reference

1. https://brunch.co.kr/@toughrogrammer/16
2. https://shlee0882.tistory.com/110
3. https://mangkyu.tistory.com/15
4. https://djswpsk1024.tistory.com/34
5. https://kadamon.tistory.com/22